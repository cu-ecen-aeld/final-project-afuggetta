#!/bin/sh

DAEMON=envchar

start() {
    echo "Loading $DAEMON kernel module..."
    modprobe $DAEMON 2>/dev/null || insmod /lib/modules/$(uname -r)/envchar.ko 2>/dev/null || echo "Failed to load $DAEMON"
}

stop() {
    echo "Unloading $DAEMON kernel module..."
    rmmod $DAEMON 2>/dev/null || true
}

case "$1" in
  start)
    start
    ;;
  stop)
    stop
    ;;
  restart)
    stop
    start
    ;;
  *)
    echo "Usage: $0 {start|stop|restart}"
    exit 1
    ;;
esac

exit 0
